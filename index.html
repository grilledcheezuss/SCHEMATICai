<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Cox Research | SCHEMATICai (v4.4 - Full List)</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script>pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';</script>
    
    <script type="module" src="database.js"></script>

    <script>
        try {
            const session = JSON.parse(localStorage.getItem('cox_auth_session'));
            if (session && session.expiry > Date.now()) {
                document.documentElement.classList.add('logged-in');
            }
        } catch(e) {}
    </script>
    
    <style>
        :root { 
            --app-primary: #461D7C;        
            --app-accent: #6A3C9E;          
            --bg-app: #e3e5e8; 
            --bg-sidebar: #ffffff; 
            --bg-card: #ffffff;
            --bg-controls: rgba(255,255,255,0.98); 
            --bg-viewer: #323639; 
            --bg-input: #ffffff;
            --bg-modal: rgba(248, 245, 255, 0.98); 
            --text-primary: #121212; 
            --text-secondary: #5f6368; 
            --text-panel-header: #461D7C; 
            --border-color: #c7c7cc; 
            --status-success: #1b5e20; 
            --status-warning: #f57f17; 
            --status-error: #b71c1c; 
            --badge-match-bg: #e8f5e9;    --badge-match-text: #1b5e20;
            --badge-varies-bg: #fff3e0;   --badge-varies-text: #c65304; 
            --badge-conflict-bg: #ffebee; --badge-conflict-text: #b71c1c; 
            --badge-neutral-bg: #f5f5f5;  --badge-neutral-text: #424242;
            --header-height: 80px; 
            --input-height: 48px;
            --z-header: 100;
            --z-sidebar: 20;
            --z-modal: 10000;
            --z-overlay: 20000;
            color-scheme: light; 
        }

        body.dark-mode {
            --bg-app: #121212; --bg-sidebar: #1e1e1e; --bg-card: #2d2d2d; 
            --bg-controls: rgba(30, 30, 30, 0.98); --bg-viewer: #1a1a1a; 
            --bg-input: #383838;
            --bg-modal: rgba(30, 30, 30, 0.98); 
            --text-panel-header: #d1c4e9; 
            --text-primary: #e8eaed; --text-secondary: #9aa0a6; --border-color: #3c4043;
            --status-success: #81c784; --status-warning: #ffb74d; --status-error: #e57373;
            --badge-match-bg: #1b3d21;    --badge-match-text: #a5d6a7;
            --badge-varies-bg: #4a3316;   --badge-varies-text: #ffcc80;
            --badge-conflict-bg: #4c1a1a; --badge-conflict-text: #ef9a9a;
            --badge-neutral-bg: #3c4043;  --badge-neutral-text: #e8eaed;
            color-scheme: dark;            
        }
        
        * { box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; margin: 0; padding: 0; background-color: var(--bg-app); color: var(--text-primary); height: 100vh; display: flex; flex-direction: column; overflow: hidden; font-size: 15px; }

        ::selection { background: var(--app-primary); color: white; }

        /* CRASH SCREEN */
        #crash-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #330000; z-index: 30000; flex-direction: column; align-items: center; justify-content: center; text-align: center; padding: 20px; color: white; display: none; }
        .error-box { background: #550000; padding: 30px; border-radius: 12px; border: 1px solid #ff5555; max-width: 500px; box-shadow: 0 20px 60px rgba(0,0,0,0.6); }

        header { background: linear-gradient(135deg, #461D7C 0%, #2e0e57 100%); height: var(--header-height); padding: 0 25px; display: flex; align-items: center; justify-content: space-between; box-shadow: 0 4px 20px rgba(0,0,0,0.15); z-index: var(--z-header); flex-shrink: 0; position: relative; }
        .logo-group { text-decoration: none; display: flex; flex-direction: column; line-height: 1; z-index: 2; }
        .logo-main { font-family: 'Helvetica Neue', Arial, sans-serif; font-size: 2.2rem; font-weight: 900; color: white; letter-spacing: -1px; text-transform: uppercase; }
        .logo-sub { font-family: 'Helvetica Neue', Arial, sans-serif; font-size: 0.75rem; color: #b39ddb; font-weight: 700; letter-spacing: 4px; text-transform: uppercase; margin-top: 4px; }
        .version-badge { position: absolute; left: 50%; top: 50%; transform: translate(-50%, -50%); background: rgba(255, 255, 255, 0.15); border: 1px solid rgba(255, 255, 255, 0.3); color: white; padding: 8px 20px; border-radius: 20px; font-weight: 800; font-size: 14px; letter-spacing: 1px; pointer-events: none; white-space: nowrap; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .version-text-ai { font-style: italic; color: #d1c4e9; }
        .header-controls { display: flex; align-items: center; gap: 12px; z-index: 2; margin-left: auto; }
        
        .control-btn { background: rgba(255, 255, 255, 0.15); border: 1px solid rgba(255, 255, 255, 0.3); color: white; width: 42px; height: 42px; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 20px; transition: all 0.2s; overflow: hidden; }
        .control-btn:hover { background: rgba(255,255,255,0.3); }
        .btn-bug { padding: 0; font-size: 0; color: transparent; }
        .bug-icon-img { width: 100%; height: 100%; object-fit: cover; display: block; }
        
        .header-separator { width: 1px; height: 24px; background: rgba(255,255,255,0.2); margin: 0 5px; }
        .btn-logout { color: #ffcccc; border-color: rgba(255, 200, 200, 0.3); margin-left: 5px; }
        .btn-logout:hover { background: var(--status-error); border-color: var(--status-error); color: white; }

        .cox-input { width: 100%; height: var(--input-height); padding: 0 12px; border: 1px solid var(--border-color); border-radius: 8px; font-size: 14px; background: var(--bg-input); color: var(--text-primary); outline: none; transition: border-color 0.2s; box-sizing: border-box; appearance: none; }
        select.cox-input { background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%235f6368' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e"); background-repeat: no-repeat; background-position: right 10px center; background-size: 16px; padding-right: 30px; color-scheme: dark; }
        .cox-input:focus { border-color: var(--app-primary); box-shadow: 0 0 0 2px rgba(70, 29, 124, 0.25); }
        option { background-color: var(--bg-app); color: var(--text-primary); }

        #app-container { display: none; flex: 1; overflow: hidden; height: calc(100vh - var(--header-height)); position: relative; }
        html.logged-in #auth-overlay { display: none !important; } html.logged-in #app-container { display: flex !important; }
        
        #auth-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--bg-app); z-index: 20000; display: flex; align-items: flex-start; justify-content: center; overflow-y: auto; padding: 50px 0; }
        .auth-card { background: var(--bg-card); padding: 40px; border-radius: 12px; box-shadow: 0 10px 40px rgba(0,0,0,0.1); width: 100%; max-width: 1000px; text-align: center; border: 1px solid var(--border-color); position: relative; margin: auto; }
        
        .auth-avatar-container { position: relative; width: 100px; height: 100px; margin: 0 auto 20px auto; border-radius: 50%; overflow: hidden; border: 3px solid var(--app-primary); }
        .auth-avatar { width: 100%; height: 100%; object-fit: cover; display: block; }
        
        .login-video-container { margin-top: 20px; border-top: 1px solid var(--border-color); padding-top: 20px; position: relative; width: 100%; padding-bottom: 56.25%; height: 0; overflow: hidden; border-radius: 8px; }
        .login-video { position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none; }

        .auth-btn { width: 100%; padding: 12px; background: var(--app-primary); color: white; border: none; border-radius: 6px; font-weight: 700; font-size: 16px; cursor: pointer; margin-top: 10px; transition: 0.2s; }
        .auth-toggle { margin-top: 20px; font-size: 13px; color: var(--text-secondary); text-decoration: underline; cursor: pointer; display: block; }
        #auth-register-view { display: none; }

        #sidebar { width: var(--sidebar-width); min-width: 320px; background: var(--bg-sidebar); border-right: 1px solid var(--border-color); display: flex; flex-direction: column; z-index: var(--z-sidebar); transition: width 0.3s ease; }
        .sidebar-controls { padding: 15px; background: var(--bg-controls); backdrop-filter: blur(10px); border-bottom: 1px solid var(--border-color); display: flex; flex-direction: column; gap: 10px; }
        .sidebar-controls.collapsed .input-group, .sidebar-controls.collapsed .action-row, .sidebar-controls.collapsed #demo-inputs-container, .sidebar-controls.collapsed .filter-grid { display: none !important; }
        .filter-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
        .input-group { display: flex; flex-direction: column; gap: 2px; }
        .input-label { font-size: 10px; font-weight: 800; text-transform: uppercase; color: var(--text-secondary); padding-left: 2px; }
        .action-row { display: flex; gap: 8px; margin-top: 2px; }
        
        /* SEARCH BUTTON FIXED */
        .search-btn { flex: 1; height: 40px; background-color: #461D7C !important; color: white !important; border: none; border-radius: 6px; font-weight: 800; cursor: pointer; font-size: 14px; opacity: 1 !important; display: block; margin-top:5px; }
        .search-btn:disabled { background-color: #555 !important; opacity: 0.7 !important; cursor: not-allowed; }
        .reset-btn { height: 40px; width: 40px; background: var(--bg-app); color: var(--text-secondary); border: 1px solid var(--border-color); border-radius: 6px; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 18px; flex: 0 0 auto; margin-top:5px; }

        .refine-search-btn { display: none; width: 100%; padding: 8px; background: var(--bg-app); border: 1px dashed var(--app-primary); color: var(--app-primary); font-weight: 700; border-radius: 6px; cursor: pointer; margin-bottom: 5px; font-size: 12px; }
        .sidebar-controls.collapsed .refine-search-btn { display: block; }
        
        #demo-inputs-container { display: none; flex-direction: column; gap: 8px; margin-top: 8px; padding-top: 8px; border-top: 1px solid var(--border-color); background: rgba(70, 29, 124, 0.05); padding: 10px; border-radius: 6px; border: 1px solid var(--app-accent); }
        .demo-label { font-size: 10px; font-weight: 800; color: var(--app-primary); text-transform: uppercase; margin-bottom: 2px; }
        .input-wrapper { position: relative; width: 100%; }
        .search-redaction { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: white; z-index: 10; display: none; align-items: center; padding-left: 10px; border-radius: 8px; pointer-events: none; }
        .search-redaction.active { display: flex; }
        .redaction-tag { background: #f3f4f6; color: #9ca3af; font-size: 10px; font-weight: 800; padding: 2px 6px; border-radius: 4px; border: 1px solid #e5e7eb; text-transform: uppercase; letter-spacing: 1px; }

        #results-scroll-area { flex: 1; overflow-y: auto; padding: 15px; background: var(--bg-app); scroll-behavior: smooth; }
        #results-area { display: flex; flex-direction: column; gap: 8px; max-width: 100%; margin: 0 auto; padding-bottom: 80px; }
        .record-card { background: var(--bg-card); padding: 6px 10px; border-radius: 8px; border: 1px solid var(--border-color); border-left: 5px solid var(--app-primary); box-shadow: 0 1px 3px rgba(0,0,0,0.05); cursor: pointer; position: relative; }
        .record-card.active-view { border-color: #6A3C9E; background: rgba(70, 29, 124, 0.05); border-left-width: 6px; }
        .record-card.low-score { background-color: var(--fail-bg); border-color: var(--fail-border); border-left-color: var(--fail-color); opacity: 0.95; }
        
        .panel-label { font-size: 9px; font-weight: 800; text-transform: uppercase; opacity: 0.8; color: var(--text-secondary); }
        .panel-name { font-size: 18px; font-weight: 800; color: var(--text-panel-header); line-height: 1.1; margin: 2px 0; letter-spacing: -0.5px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 100%; }
        
        .hud-row { display: flex; gap: 4px; margin-top: 2px; flex-wrap: wrap; }
        .hud-badge { font-size: 9px; font-weight: 700; text-transform: uppercase; padding: 1px 5px; border-radius: 3px; background: #eee; color: #333; }
        .hud-badge.match { background: #e8f5e9; color: #1b5e20; }
        .rl-actions { margin-left: auto; display: flex; gap: 8px; }
        .btn-rl { background: transparent; border: 1px solid var(--border-color); color: var(--text-secondary); border-radius: 4px; padding: 1px 6px; cursor: pointer; font-size: 12px; transition: all 0.2s; display:flex; align-items:center; justify-content:center; }
        .btn-match:hover { background: var(--status-success); color: white; border-color: var(--status-success); }
        .btn-match:disabled { opacity: 0.5; cursor: default; }

        #preview-pane { flex: 1; background: var(--bg-viewer); position: relative; display: flex; flex-direction: column; overflow: hidden; }
        #pdf-render-container { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; align-items: center; gap: 15px; }
        .page-container { background: white; box-shadow: 0 10px 40px rgba(0,0,0,0.5); }
        .placeholder-msg { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; color: rgba(255,255,255,0.5); font-size: 22px; }
        .mobile-toolbar { display: none; width: 100%; padding: 20px; background: #2a2a2a; justify-content: space-between; align-items: center; z-index: 3000; }
        .mobile-btn { padding: 12px 24px; border-radius: 10px; font-weight: 800; color: white; text-decoration: none; display: inline-flex; align-items: center; justify-content: center; }

        /* MODALS (Fixed Center) */
        #feedback-modal, #governance-modal, #bug-modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); backdrop-filter: blur(4px); z-index: 10000; align-items: center; justify-content: center; }
        #feedback-modal.active, #governance-modal.active, #bug-modal.active { display: flex !important; }

        .bug-card, .gov-card, .modal-card { background: var(--bg-card); border-radius: 12px; box-shadow: 0 20px 60px rgba(0,0,0,0.5); overflow: hidden; border: 1px solid var(--border-color); }
        .bug-card { width: 500px; padding: 0; display: flex; flex-direction: column; }
        .gov-card { width: 600px; max-height: 80vh; display: flex; flex-direction: column; }
        .modal-card { width: 320px; position: absolute; bottom: 20px; right: 20px; }

        .modal-header { background: linear-gradient(135deg, #461D7C 0%, #2e0e57 100%); padding: 15px; display: flex; justify-content: space-between; align-items: center; color: white; }
        .modal-title { font-weight: 800; font-size: 16px; margin: 0; }
        .btn-close { background: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.3); color: white; border-radius: 6px; padding: 4px 12px; cursor: pointer; font-weight: 700; font-size: 12px; }
        
        .modal-content { padding: 15px; }
        .bug-textarea { width: 100%; height: 120px; padding: 15px; border: none; border-bottom: 1px solid var(--border-color); font-family: inherit; resize: none; background: var(--bg-input); color: var(--text-primary); font-size: 14px; box-sizing: border-box; }
        .bug-preview { max-width: 100%; max-height: 200px; display: none; object-fit: contain; background: #000; }

        #tuner-panel { width: 0; background: var(--bg-sidebar); border-left: 1px solid var(--border-color); display: flex; flex-direction: column; transition: width 0.3s; overflow: hidden; z-index: 15; position: relative; }
        #tuner-panel.open { width: 400px; border-left: 2px solid var(--app-primary); }
        .tuner-content-wrapper { min-width: 400px; padding: 20px; }
        .gov-item { padding: 12px 15px; border-bottom: 1px solid var(--border-color); display: flex; justify-content: space-between; align-items: center; }
        .gov-panel { font-weight: 800; font-size: 13px; color: var(--app-primary); }
        .gov-action { background: var(--status-error); color: white; border: none; padding: 4px 10px; border-radius: 4px; cursor: pointer; font-size: 10px; font-weight: 700; }
        .gov-footer { padding: 12px 15px; background: var(--bg-sidebar); border-top: 1px solid var(--border-color); display: flex; gap: 8px; }
        .gov-dashboard { padding: 12px; background: rgba(70, 29, 124, 0.05); border-bottom: 1px solid var(--border-color); display: flex; justify-content: space-around; align-items: center; }
        .stat-val { font-size: 18px; font-weight: 900; color: var(--app-primary); }
        .stat-lbl { font-size: 9px; text-transform: uppercase; color: var(--text-secondary); letter-spacing: 1px; margin-top: 2px; }
        .feedback-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 6px; }
        .reason-btn { width: 100%; padding: 8px; border: 1px solid #d1c4e9; background: var(--bg-input); color: var(--text-primary); border-radius: 6px; text-align: left; cursor: pointer; display: flex; justify-content: space-between; align-items: center; font-size: 11px; font-weight: 600; transition: all 0.2s; }
        .reason-btn:hover { border-color: var(--app-primary); background: var(--badge-predict-bg); color: var(--app-primary); }
        .submit-feedback-btn { flex: 1; padding: 10px; background: var(--app-primary); color: white; border: none; border-radius: 6px; font-weight: 800; cursor: pointer; font-size: 12px;}
        .undo-btn { flex: 1; padding: 10px; background: var(--bg-input); border: 2px solid var(--text-primary); color: var(--text-primary); font-size: 12px; font-weight: 800; cursor: pointer; border-radius: 6px; }
        .btn-export { flex: 1; padding: 10px; border-radius: 6px; font-weight: 700; cursor: pointer; border: none; color: white; font-size: 12px; text-transform: uppercase; }
        .btn-export.cloud { background: var(--app-primary); }
        .btn-export.csv { background: var(--status-success); }

        @media (max-width: 900px) { 
            #sidebar { width: 100%; z-index: 10; }
            #preview-pane { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 2000; display: none; background: #1a1a1a; }
            #preview-pane.active { display: flex; }
            header { padding: 15px; }
        }
    </style>
</head>
<body>

<div id="crash-screen" style="display:none;">
    <div class="error-box">
        <div style="font-size:50px; margin-bottom:10px;">üí•</div>
        <h2>Critical Data Error</h2>
        <p id="error-msg" style="color:#ffcccc; line-height:1.5; margin-bottom:20px;">System Failure.</p>
        <button class="reset-btn-hard" onclick="DatabaseService.hardReset()" style="background:white; color:#550000; border:none; padding:10px 20px; border-radius:6px; font-weight:800; cursor:pointer;">‚ö† HARD RESET DATABASE</button>
    </div>
</div>

<div id="auth-overlay">
    <div class="auth-card">
        <div class="auth-avatar-container">
            <img src="image_f7315b.jpg" alt="User" class="auth-avatar">
        </div>
        <h2 style="margin:0 0 10px 0; color:var(--app-primary)">SCHEMATICai</h2>
        <div id="auth-login-view">
            <input type="text" id="auth-user" class="cox-input" placeholder="Username" onkeyup="if(event.key==='Enter') AuthService.login()">
            <input type="password" id="auth-pin" class="cox-input" style="margin-top:10px;" placeholder="Passcode / PIN" onkeyup="if(event.key==='Enter') AuthService.login()">
            <button class="auth-btn" onclick="AuthService.login()">Authenticate</button>
            <a class="auth-toggle" onclick="AuthService.toggleRegister()">First time? Register here</a>
        </div>
        <div id="auth-register-view">
            <input type="text" id="reg-user" class="cox-input" placeholder="Your Assigned Username">
            <button class="auth-btn" id="check-user-btn" onclick="AuthService.checkUser()">Verify Username</button>
            <div id="reg-step-2" style="display:none; margin-top:15px; border-top:1px solid var(--border-color); padding-top:15px;">
                <input type="password" id="reg-pass" class="cox-input" placeholder="Create Passcode">
                <input type="password" id="reg-confirm" class="cox-input" style="margin-top:10px;" placeholder="Confirm Passcode">
                <button class="auth-btn" onclick="AuthService.finalizeRegistration()">Complete Registration</button>
            </div>
            <a class="auth-toggle" onclick="AuthService.toggleRegister()">Back to Login</a>
        </div>
        <div class="login-video-container">
            <iframe class="login-video" src="https://www.youtube-nocookie.com/embed/vEzBFpontU0?autoplay=1&mute=1&loop=1&playlist=vEzBFpontU0&controls=0&rel=0" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>
        </div>
    </div>
</div>

<header>
    <a href="https://coxresearch.com/" class="logo-group">
        <span class="logo-main">COX</span>
        <span class="logo-sub">RESEARCH</span>
    </a>
    <div class="version-badge">SCHEMATIC<span class="version-text-ai">ai</span> v4.4</div>
    <div class="header-controls">
        <button class="control-btn btn-bug" onclick="BugController.open()" title="Report Bug">
            <img src="image_f7315b.jpg" alt="Bug Report" class="bug-icon-img" onerror="this.style.display='none'; this.parentNode.classList.add('image-missing');">
        </button>
        <button class="control-btn" id="demoToggle" onclick="UI.toggleDemoMode()" title="Toggle Demo Mode">üëÅÔ∏è‚Äçüó®Ô∏è</button>
        <button class="control-btn" id="tunerToggle" onclick="UI.toggleTuner()" style="display:none;" title="Adjust Redaction Zones">‚öôÔ∏è</button>
        <button class="control-btn dark-mode-btn" onclick="UI.toggleDarkMode()" title="Toggle Dark Mode">üåì</button>
        <div class="header-separator"></div>
        <button class="control-btn btn-logout" onclick="AuthService.logout()" title="Logout">‚èª</button>
    </div>
</header>

<div id="feedback-modal" style="display:none;">
    <div class="modal-card">
        <div class="modal-header">
            <span class="modal-title">Improve the AI</span>
            <button class="btn-close" onclick="UI.closeFeedbackModal()">X</button>
        </div>
        <div class="modal-content" id="modal-content"></div>
    </div>
</div>

<div id="bug-modal" style="display:none;">
    <div class="bug-card">
        <div class="modal-header">
            <span class="modal-title">üêû Report a Bug</span>
            <button class="btn-close" onclick="BugController.close()">X</button>
        </div>
        <div style="padding:0;">
            <textarea id="bug-desc" class="bug-textarea" placeholder="What happened? e.g., 'Search failed on 480V'"></textarea>
            <img id="bug-preview-img" class="bug-preview">
        </div>
        <div style="padding:15px; text-align:right; border-top:1px solid var(--border-color); background: var(--bg-sidebar);">
            <button class="auth-btn" style="width:auto; margin:0;" onclick="BugController.send()">Send Report</button>
        </div>
    </div>
</div>

<div id="governance-modal" style="display:none;">
    <div class="gov-card">
        <div class="gov-header">
            <span class="gov-title">AI Governance Log</span>
            <button class="btn-close" onclick="UI.closeGovModal()">Close</button>
        </div>
        <div class="gov-dashboard">
            <div class="stat-box"><span class="stat-val" id="stat-total">0</span><span class="stat-lbl">Total Records</span></div>
            <div class="stat-box"><span class="stat-val" id="stat-healed">0</span><span class="stat-lbl">AI Repaired</span></div>
        </div>
        <div class="gov-content" id="gov-list"></div>
        <div class="gov-footer">
            <button class="btn-export cloud" onclick="GoldenRecordManager.uploadToCloud(this)">‚òÅ UPLOAD TO CLOUD DB (UC)</button>
            <button class="btn-export csv" onclick="GoldenRecordManager.export('csv')">‚¨á CSV</button>
        </div>
    </div>
</div>

<div id="app-container">
    <div id="sidebar">
        <div class="sidebar-controls">
            <button class="refine-search-btn" onclick="UI.toggleSearchUI(true)">üîç REFINE SEARCH / EDIT FILTERS</button>
            <div class="input-group"><span class="input-label">Keywords</span><div class="input-wrapper"><input type="text" id="keywordInput" class="cox-input" placeholder="e.g. Duplex, 1PH, CP-7920" onkeypress="UI.handleEnter(event)"></div></div>
            <div class="filter-grid">
                <div class="input-group"><span class="input-label">Manufacturer</span><select id="mfgInput" class="cox-input" disabled><option value="">Any</option></select></div>
                <div class="input-group"><span class="input-label">Phase</span><select id="phaseInput" class="cox-input" disabled><option value="">Any</option></select></div>
                <div class="input-group"><span class="input-label">HP</span><select id="hpInput" class="cox-input" disabled><option value="">Any</option></select></div>
                <div class="input-group"><span class="input-label">Voltage</span><select id="voltInput" class="cox-input" disabled><option value="">Any</option></select></div>
                <div class="input-group"><span class="input-label">Enclosure</span><select id="enclosureInput" class="cox-input" disabled><option value="">Any</option></select></div>
            </div>
            <div class="action-row">
                <button class="reset-btn" onclick="UI.resetSearch()" title="Clear All">‚Ü∫</button>
                <button class="search-btn" id="searchBtn" disabled onclick="SearchEngine.perform()">SEARCH</button>
            </div>
            <div id="demo-inputs-container"><div class="demo-label">Demo Configuration</div><input type="text" class="cox-input demo-input" id="demoCustomerInput" placeholder="Client Name" oninput="PdfController.updateRedactions();"></div>
            <div class="filter-row">
                <select class="cox-input" id="resultFilter" onchange="SearchEngine.applyFilter(false)">
                    <option value="ALL">Show Matches (Green & Orange)</option>
                    <option value="EXACT">Perfect Only (Green)</option>
                    <option value="VARIABLE">Varied Only (Orange)</option>
                    <option value="MISMATCH">Show Mismatches (Red)</option>
                </select>
            </div>
        </div>
        <div id="results-scroll-area"><div id="results-area"></div></div>
    </div>
    
    <div id="preview-pane">
        <div class="mobile-toolbar"><button class="mobile-btn btn-close" onclick="UI.closePdf()">‚úñ CLOSE</button></div>
        <div class="placeholder-msg" id="preview-placeholder"><span style="font-size:48px;">üìÑ</span><br><br>Select a schematic</div>
        <div id="pdf-render-container"></div>
    </div>

    <div id="tuner-panel">
        <div class="tuner-content-wrapper"><div class="tuner-header"><span>REDACTION ZONES</span><button class="btn-close" onclick="UI.toggleTuner()">Close</button></div><div class="tuner-body"></div></div>
    </div>
</div>

<script>
// --- SCHEMATICai v4.4 ---
const STORAGE_KEYS = { SESSION: 'cox_auth_session', ZONES: 'cox_zones_v4_7', MARKOV: 'cox_markov_cache', VOCAB: 'cox_dynamic_vocab_v1' };
const CONFIG = { FIELDS: { TARGET: 'Items', NAME: 'Control Panel Name', PDF: 'Control Panel PDF' } };

// FIXED: Full Manufacturer List Restored
const CONSTANTS = { 
    MANUFACTURERS: { 
        'gorman rupp':['gorman','gr'], 'barnes':['barnes','sithe'], 'hydromatic':['hydromatic','hydro-matic'],
        'flygt':['flygt'], 'myers':['myers'], 'goulds':['goulds'], 'zoeller':['zoeller'], 
        'liberty':['liberty'], 'wilo':['wilo'], 'pentair':['pentair'], 'abs':['abs'], 'aurora':['aurora'] 
    }, 
    DATA: { 
        HP: [0.5, 0.75, 1, 1.5, 2, 3, 5, 6.2, 7.5, 10, 15, 20, 25, 30, 40, 50, 60, 75, 100], 
        VOLT: [120, 208, 240, 480, 575], PHASE: [1, 3], ENCLOSURE: ["NEMA 4X Stainless", "NEMA 4X Fiberglass", "Poly"] 
    } 
};

// --- CLASSES ---
class BugController {
    static blob = null;
    static init() { document.addEventListener('paste', (e) => { /* logic */ }); }
    static open() { document.getElementById('bug-modal').classList.add('active'); }
    static close() { document.getElementById('bug-modal').classList.remove('active'); }
    static async send() { alert('Bug report simulation sent.'); this.close(); }
}

class VocabService {
    static init() {}
    static get(cat) { return []; }
}

class AuthService {
    static init() { 
        const session = JSON.parse(localStorage.getItem(STORAGE_KEYS.SESSION)); 
        if (session && session.expiry > Date.now()) { 
            document.getElementById('app-container').classList.add('visible'); 
            return true; 
        } 
        document.getElementById('auth-overlay').style.display = 'flex'; 
        return false; 
    }
    static toggleRegister() { 
        const loginV = document.getElementById('auth-login-view'); 
        const regV = document.getElementById('auth-register-view'); 
        if (loginV.style.display === 'none') { loginV.style.display = 'block'; regV.style.display = 'none'; } 
        else { loginV.style.display = 'none'; regV.style.display = 'block'; } 
    }
    static async login() { 
        const user = document.getElementById('auth-user').value.trim(); 
        if(!user) return;
        localStorage.setItem(STORAGE_KEYS.SESSION, JSON.stringify({ user: user, expiry: Date.now() + 86400000 })); 
        window.location.reload(); 
    }
    static logout() { localStorage.removeItem(STORAGE_KEYS.SESSION); location.reload(); }
    static checkUser() { alert('Simulated check'); }
    static finalizeRegistration() { alert('Simulated Reg'); this.login(); }
}

class DatabaseService {
    static allRecords = []; static masterData = {};
    static async init() { 
        if(window.LOCAL_PANEL_DATA) this.processLocalData(window.LOCAL_PANEL_DATA);
        return true; 
    }
    static async searchCloud(keywords) {
        if(window.location.protocol === 'file:') {
            alert("‚ö†Ô∏è SECURITY WARNING ‚ö†Ô∏è\n\nYou are running this file from your Local Disk (file:///).\nThe Proxy Search cannot run securely here.\n\nPlease upload this code to GitHub and Vercel to enable the search function.");
            return;
        }
        
        try {
            const resp = await fetch('/api/search?q=' + encodeURIComponent(keywords));
            const data = await resp.json();
            if (data.results) {
                this.allRecords = data.results; 
                UI.renderResults(false);
            }
        } catch (e) { console.error("Proxy Search Failed", e); }
    }
    static hardReset() { localStorage.clear(); window.location.reload(); }
    static processLocalData(data) { /* stub */ }
}

class SearchEngine {
    static init() {}
    static perform() { 
        const kw = document.getElementById('keywordInput').value.trim(); 
        const mfg = document.getElementById('mfgInput').value;
        const hp = document.getElementById('hpInput').value;
        const volt = document.getElementById('voltInput').value;
        const phase = document.getElementById('phaseInput').value;
        const enc = document.getElementById('enclosureInput').value;
        
        // Build composite search query if keyword box is empty
        let parts = [];
        if(kw) parts.push(kw);
        if(mfg && mfg !== "Any") parts.push(mfg);
        if(hp && hp !== "Any") parts.push(hp + "hp"); // Append unit for tighter matching
        if(volt && volt !== "Any") parts.push(volt);
        if(phase && phase !== "Any") parts.push(phase + "ph");
        if(enc && enc !== "Any") parts.push(enc);

        const finalQuery = parts.join(", "); // Send comma-separated list to proxy

        if(!finalQuery) { 
            alert("Please enter keywords or select filters."); 
            return; 
        }

        const btn = document.getElementById('searchBtn');
        btn.disabled = true; 
        btn.innerText = "SEARCHING...";
        
        DatabaseService.searchCloud(finalQuery).then(() => {
            btn.disabled = false;
            btn.innerText = "SEARCH";
        });
    }
    static applyFilter() {}
}

class UI {
    static toggleDarkMode() { document.body.classList.toggle('dark-mode'); }
    static toggleDemoMode() {}
    static toggleTuner() { document.getElementById('tuner-panel').classList.toggle('open'); }
    static closePdf() { document.getElementById('preview-pane').classList.remove('active'); }
    static handleEnter(e) { if(e.key==='Enter') SearchEngine.perform(); }
    static resetSearch() { 
        document.getElementById('keywordInput').value=''; 
        document.querySelectorAll('select').forEach(s => s.value = "");
        UI.populateDropdown();
        document.getElementById('results-area').innerHTML=''; 
    }
    
    // UPDATED: No more hardcoded "Mock" text
    static renderResults() { 
        const area = document.getElementById('results-area'); 
        if (DatabaseService.allRecords && DatabaseService.allRecords.length > 0) {
            // If we have records, we would render them here. 
            // For now, we leave it clear rather than showing fake text.
        } else {
             area.innerHTML = '<div style="padding:20px; text-align:center; opacity:0.7;">No results found or search incomplete.</div>';
        }
    }
    
    static populateDropdown() {
        ['mfg', 'hp', 'volt', 'enclosure', 'phase'].forEach(cat => { 
            const select = document.getElementById(cat + 'Input'); 
            if(!select) return; 
            const currentVal = select.value;
            select.innerHTML = '<option value="">Any</option>'; 
            let items = [];
            if(CONSTANTS.DATA[cat.toUpperCase()]) items = CONSTANTS.DATA[cat.toUpperCase()];
            if(cat === 'mfg') items = Object.keys(CONSTANTS.MANUFACTURERS).map(k => k.toUpperCase());
            
            items.forEach(i => {
                const opt = document.createElement('option');
                opt.value = i; opt.innerText = i;
                select.appendChild(opt);
            });
            if(currentVal) select.value = currentVal;
        });
    }
    static enableSearch(e) { 
        const btn = document.getElementById('searchBtn'); btn.disabled = !e; 
        if(e) btn.innerText = "SEARCH"; 
        document.querySelectorAll('.cox-input').forEach(el => el.disabled = !e); 
        document.querySelectorAll('.reset-btn').forEach(el => el.disabled = !e); 
    }
    static closeFeedbackModal() { document.getElementById('feedback-modal').classList.remove('active'); }
    static toggleGovModal() { document.getElementById('governance-modal').classList.toggle('active'); }
    static closeGovModal() { document.getElementById('governance-modal').classList.remove('active'); }
}

class PdfController {
    static async load(url) {}
    static updateRedactions() {}
    static addZone() {}
}

class App {
    static init() {
        VocabService.init(); 
        BugController.init();
        if (!AuthService.init()) return;
        App.loadData();
    }
    static loadData() {
        DatabaseService.init().then(() => {
            UI.populateDropdown();
            UI.enableSearch(true);
            document.getElementById('crash-screen').style.display = 'none';
        });
    }
}

// Start
if (typeof App !== 'undefined') {
    document.addEventListener('DOMContentLoaded', App.init);
}
</script>
</body>
</html>